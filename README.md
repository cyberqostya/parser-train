# Парсер информации с авито (Puppeteer) TypeScript
### Первоначальная версия на JavaScript в ветке _project-on-js_

# Проект несет исключительно образовательный смысл!
# Никакие данные никто никуда не распространя(л)ет

### Чтобы спарсить данные с сайта Авито, 
1. ```git clone```
1. ```npm install```
1. ```Добавить ссылку для парсинга в ./login.js  loginData.parsingUrl```
1. ```npm start```
1. ```Подождать (заварить кофейка)```
1. ```Смотреть data/data.json```

### Записки ~~взломщика~~ разработчика
* Проработан [puppeteer](https://github.com/puppeteer/puppeteer/blob/v13.5.1/docs/api.md)
* Изучен DOM [Avito](https://www.avito.ru/sankt-peterburg/sport_i_otdyh/nastolnye_igry-ASgBAgICAUTKAoZP?cd=1&q=root)
* Не обошлось без [Хабр](https://qna.habr.com/), [СтакОверфлоу](https://stackoverflow.com/)
* Чтобы получить поля "номер телефона" и "автор объявления", необходимо залогиниться
  1. Чтобы не использовать свои настоящие данные для входа, был создан виртуальный телефон
  1. Регистрация удалась, но потом аккаунт заморозили из-за подозрительной активности
  1. Чтобы разморозить аккаунт необходимо было приложить фото паспорта
  1. Воспользовавшись AdobePhotoshop, были предприняты попытки обойти охранную систему Авито - _неудача_

* Предпринята попытка логиниться со своими настоящими данными через puppeteer - стала всплывать КАПЧА
  1. Для обхода капчи были изучены некоторые ресурсы и сам код капчи в поисках уязвимостей, оставленных разработчиками - _неудача_

* Принято решение обойти логин: предпринята попытка использования puppeteer не в Chromium, а непосредственно в браузере Chrom с непосредственно залогиненым пользователем, чтобы парсинг происходил от его имени - _неудача_

* К тому же: поле "телефон" Авито выдает в формате изображения (видимо часто сталкиваются с парсингом)
  1. Начат поиск по извлечению текста с картинки: найден [Tesseract.js](https://proglib.io/p/tesseract-js-izvlekaem-tekst-iz-kartinok-s-pomoshchyu-javascript-2020-04-22)
  1. Обнаружено, что в мобильной версии сайта Авито телефон выдается в текстовом формате, а только в ПК - в виде изображения: идея с tesseract.js отклоняется

* Запись полученных от парсера данных записывается в data/data.json
* В итоге имеем поля:
```
{
  title: string;
  description: string;
  url: string;
  price: number;
  author: string; // Частное лицо
  date: string; // ISO-8601
  phone: string; // 8 911 ХХХ ХХ ХХ
}
```
* Особая гордость за функцию преобразования даты в нужный формат  
_Иногода при первом парсинге выскакиевает ошибка про textContent. При повторном вводе команды ```npm start``` данные парсятся успешно. Причина ошибки ~~неизвестна~~ засекречена._


